<!-- templates/add_member.html -->
{% extends "base.html" %}

{% block title %}Add Member - Samaj Seva{% endblock %}

{% block content %}
<div class="container-fluid px-3 px-md-5 py-3">
    <div class="d-flex justify-content-between align-items-center flex-wrap border-bottom pb-2 mb-3">
        <h2 class="h4 mb-2">Add Member / સભ્ય ઉમેરો</h2>
        <a href="{{ url_for('view_members') }}" class="btn btn-outline-secondary btn-sm">
            ← Back / પાછા
        </a>
    </div>

    <div class="row g-3">
        <!-- Left: Form -->
        <div class="col-12 col-lg-8">
            <div class="card shadow-sm border-0">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0">Member Information / સભ્યની માહિતી</h5>
                </div>
                <div class="card-body">
                    <form method="POST" enctype="multipart/form-data">
                        
                        <!-- Family Selection -->
                        <div class="row g-3">
                            <div class="col-12 col-md-6">
                                <label class="form-label fw-semibold">Select Family / કુટુંબ પસંદ કરો <span class="text-danger">*</span></label>
                                <select class="form-select" id="family_id" name="family_id" required>
                                    <option value="">Select Family / કુટુંબ પસંદ કરો</option>
                                    {% for family in families %}
                                        <option value="{{ family[0] }}">{{ family[1] }} - {{ family[2] }} ({{ family[3] }})</option>
                                    {% endfor %}
                                </select>
                            </div>
                            <div class="col-12 col-md-6">
                                <label class="form-label fw-semibold">Father/Husband Name / પિતા/પતિનું નામ</label>
                                <input type="text" class="form-control" id="father_husband_name" name="father_husband_name"
                                       placeholder="Enter father/husband name">
                            </div>
                        </div>

                        <!-- Basic Information -->
                        <div class="row g-3 mt-1">
                            <div class="col-12 col-md-6">
                                <label class="form-label fw-semibold">Member Name / સભ્યનું નામ <span class="text-danger">*</span></label>
                                <input type="text" class="form-control" id="name" name="name" required placeholder="Enter member name">
                            </div>
                            <div class="col-12 col-md-6">
                                <label class="form-label fw-semibold">Gender / લિંગ <span class="text-danger">*</span></label>
                                <select class="form-select" id="gender" name="gender" required>
                                    <option value="">Select / પસંદ કરો</option>
                                    <option value="Male">Male / પુરુષ</option>
                                    <option value="Female">Female / સ્ત્રી</option>
                                    <option value="Other">Other / અન્ય</option>
                                </select>
                            </div>
                        </div>

                        <!-- Birth Information -->
                        <div class="row g-3 mt-1">
                            <div class="col-12 col-md-6">
                                <label class="form-label fw-semibold">Birth Date / જન્મતારીખ</label>
                                <input type="date" class="form-control" id="birthdate" name="birthdate">
                            </div>
                            <div class="col-12 col-md-6">
                                <label class="form-label fw-semibold">Age / ઉંમર</label>
                                <input type="number" class="form-control" id="age" name="age" placeholder="Enter age" min="0" max="120">
                            </div>
                        </div>

                        <!-- Contact -->
                        <div class="row g-3 mt-1">
                            <div class="col-12 col-md-6">
                                <label class="form-label fw-semibold">Mobile Number / મોબાઇલ નંબર</label>
                                <div class="input-group">
                                    <span class="input-group-text">+91</span>
                                    <input type="tel" class="form-control" id="mobile" name="mobile" placeholder="XXXXXXXXXX" pattern="[0-9]{10}">
                                </div>
                                <div class="form-text">10-digit mobile number without +91</div>
                            </div>
                            <div class="col-12 col-md-6">
                                <label class="form-label fw-semibold">Birth Place / જન્મસ્થળ</label>
                                <input type="text" class="form-control" id="birth_place" name="birth_place" placeholder="Enter birth place">
                            </div>
                        </div>

                        <!-- Address -->
                        <div class="mt-3">
                            <label class="form-label fw-semibold">Address / સરનામું</label>
                            <textarea class="form-control" id="address" name="address" rows="2" placeholder="Enter address"></textarea>
                        </div>

                        <!-- Education & Occupation -->
                        <div class="row g-3 mt-1">
                            <div class="col-12 col-md-6">
                                <label class="form-label fw-semibold">Education / શિક્ષણ</label>
                                <select class="form-select" id="education" name="education">
                                    <option value="">Select / પસંદ કરો</option>
                                    <option>Illiterate / નિરક્ષર</option>
                                    <option>Primary / પ્રાથમિક</option>
                                    <option>Secondary / માધ્યમિક</option>
                                    <option>High School / હાઈસ્કૂલ</option>
                                    <option>Diploma / ડિપ્લોમા</option>
                                    <option>Graduate / સ્નાતક</option>
                                    <option>Post Graduate / સ્નાતકોત્તર</option>
                                    <option>PhD / ડોક્ટરેટ</option>
                                    <option>Other / અન્ય</option>
                                </select>
                            </div>
                            <div class="col-12 col-md-6">
                                <label class="form-label fw-semibold">Occupation / વ્યવસાય</label>
                                <input type="text" class="form-control" id="occupation" name="occupation" placeholder="Enter occupation">
                            </div>
                        </div>

                        <!-- Relation & Photo -->
                        <div class="row g-3 mt-1">
                            <div class="col-12 col-md-6">
                                <label class="form-label fw-semibold">Relation to Head / મુખ્ય સાથે સંબંધ</label>
                                <input type="text" class="form-control" id="relation" name="relation" placeholder="e.g., Son, Wife, Daughter">
                            </div>
                            <div class="col-12 col-md-6">
                                <label class="form-label fw-semibold">Photo / ફોટો</label>
                                <input type="file" class="form-control" id="photo" name="photo" accept="image/*" onchange="previewImage(this)">
                                <div class="form-text">Supported: JPG, PNG, GIF (Max: 16MB)</div>
                            </div>
                        </div>

                        <!-- Remark -->
                        <div class="mt-3">
                            <label class="form-label fw-semibold">Remark / નોંધ</label>
                            <textarea class="form-control" id="remark" name="remark" rows="2" placeholder="Enter any remarks"></textarea>
                        </div>

                        <!-- Image Preview -->
                        <div class="mt-3" id="imagePreviewContainer" style="display: none;">
                            <label class="form-label fw-semibold">Photo Preview / ફોટો પૂર્વદર્શન:</label>
                            <img id="imagePreview" src="#" alt="Preview" class="img-fluid rounded border" style="max-height:200px;">
                        </div>

                        <!-- Buttons -->
                        <div class="d-flex flex-wrap gap-2 mt-4">
                            <button type="submit" class="btn btn-success w-100 w-md-auto">Add Member / સભ્ય ઉમેરો</button>
                            <a href="{{ url_for('view_members') }}" class="btn btn-outline-secondary w-100 w-md-auto">Back / પાછા</a>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Right: Info Cards -->
        <div class="col-12 col-lg-4">
            <div class="card shadow-sm border-0 mb-3">
                <div class="card-header bg-info text-white">
                    <h6 class="mb-0">Member ID Information / સભ્ય ID માહિતી</h6>
                </div>
                <div class="card-body small">
                    <p>Member IDs are automatically generated within each family.</p>
                    <hr>
                    <ul class="mb-0">
                        <li>Family 001 → Member ID 1, 2, 3...</li>
                        <li>Family 002 → Member ID 1, 2, 3...</li>
                    </ul>
                </div>
            </div>

            <div class="card shadow-sm border-0">
                <div class="card-header bg-warning text-dark">
                    <h6 class="mb-0">Instructions / સૂચનાઓ</h6>
                </div>
                <div class="card-body small">
                    <ul class="mb-0">
                        <li>✅ Fields marked with * are required</li>
                        <li>✅ Select family first to generate ID</li>
                        <li>✅ Age auto-calculated if birthdate is provided</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
function previewImage(input) {
    const preview = document.getElementById('imagePreview');
    const container = document.getElementById('imagePreviewContainer');
    if (input.files && input.files[0]) {
        const reader = new FileReader();
        reader.onload = e => {
            preview.src = e.target.result;
            container.style.display = 'block';
        };
        reader.readAsDataURL(input.files[0]);
    } else {
        container.style.display = 'none';
    }
}

document.getElementById('birthdate').addEventListener('change', function() {
    const birthdate = new Date(this.value);
    const today = new Date();
    let age = today.getFullYear() - birthdate.getFullYear();
    const m = today.getMonth() - birthdate.getMonth();
    if (m < 0 || (m === 0 && today.getDate() < birthdate.getDate())) age--;
    if (age >= 0 && age <= 120) document.getElementById('age').value = age;
});

document.getElementById('birthdate').max = new Date().toISOString().split('T')[0];
document.getElementById('mobile').addEventListener('input', function() {
    this.value = this.value.replace(/[^0-9]/g, '').slice(0, 10);
});
</script>
{% endblock %}
