{% extends "base.html" %}
{% block title %}Families - Samaj Seva{% endblock %}
{% block content %}

<div class="container py-4">
    <!-- Header -->
    <div class="d-flex flex-column flex-md-row justify-content-between align-items-center mb-4">
        <h3 class="fw-bold text-primary mb-3 mb-md-0">üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Families</h3>
        {% if session.role in ['admin', 'village_manager'] %}
        <a href="{{ url_for('add_family') }}" class="btn btn-primary shadow-sm">
            ‚ûï Add New Family
        </a>
        {% endif %}
    </div>

    <!-- Filter -->
    <div class="card shadow-sm border-0 rounded-4 mb-4 fade-in">
        <div class="card-body">
            <form method="GET" class="row g-3 align-items-end">
                <div class="col-md-6 col-lg-4">
                    <label for="village" class="form-label fw-semibold">Filter by Village</label>
                    <select name="village" id="village" class="form-select form-select-lg rounded-3">
                        <option value="">All Villages</option>
                        {% for village in villages %}
                            <option value="{{ village }}" {% if village == selected_village %}selected{% endif %}>
                                {{ village }}
                            </option>
                        {% endfor %}
                    </select>
                </div>
                <div class="col-md-6 col-lg-4">
                    <button type="submit" class="btn btn-primary btn-lg rounded-3 px-4">Apply</button>
                    <a href="{{ url_for('families') }}" class="btn btn-outline-secondary btn-lg rounded-3 ms-2">Clear</a>
                </div>
            </form>
        </div>
    </div>

    <!-- Families List -->
    <div class="row g-4">
        {% for family in families %}
        <div class="col-12 col-md-6 col-lg-4">
            <div class="card shadow-sm border-0 rounded-4 h-100 fade-in">
                <div class="card-body">
                    <!-- Head photo + details -->
                    <div class="d-flex align-items-center mb-3">
                        <img 
                            src="{{ family[7] and url_for('uploaded_file', filename=family[7]) or 'https://via.placeholder.com/80?text=No+Photo' }}"
                            class="rounded-circle border border-2 border-primary me-3"
                            alt="Head Photo"
                            style="width: 80px; height: 80px; object-fit: cover;"
                            onerror="this.src='https://via.placeholder.com/80?text=No+Photo'">
                        <div>
                            <h5 class="fw-bold mb-1">{{ family[2] }}</h5>
                            <small class="text-muted">Family No: {{ family[1] }}</small>
                        </div>
                    </div>

                    <!-- Info grid -->
                    <div class="info-grid mb-3">
                        <div class="fw-semibold text-secondary">Birth Date:</div>
                        <div>{{ family[8] or 'Not specified' }}</div>

                        <div class="fw-semibold text-secondary">Mosad:</div>
                        <div>{{ family[9] or 'Not specified' }}</div>

                        <div class="fw-semibold text-secondary">Village:</div>
                        <div>{{ family[3] }}</div>

                        <div class="fw-semibold text-secondary">Contact:</div>
                        <div>{{ family[4] or 'Not available' }}</div>

                        <div class="fw-semibold text-secondary">Address:</div>
                        <div class="small">{{ family[5] or 'Not available' }}</div>

                        <div class="fw-semibold text-secondary">Members:</div>
                        <div><span class="badge bg-primary rounded-pill">{{ family[6] }}</span></div>
                    </div>

                    <!-- Actions -->
                    <div class="d-flex gap-2 mt-3">
                        <a href="{{ url_for('view_family', family_id=family[0]) }}" 
                           class="btn btn-outline-primary w-100">
                           üëÅ View Details
                        </a>
                        {% if session.role == 'admin' %}
                        <a href="{{ url_for('delete_family', family_id=family[0]) }}" 
                           class="btn btn-outline-danger"
                           onclick="return confirm('Are you sure you want to delete this family and all its members?')">
                           üóë Delete
                        </a>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
        {% else %}
        <div class="col-12">
            <div class="alert alert-info text-center shadow-sm rounded-4">
                No families found. 
                {% if session.role in ['admin', 'village_manager'] %}
                <a href="{{ url_for('add_family') }}" class="alert-link">Add the first family</a>.
                {% endif %}
            </div>
        </div>
        {% endfor %}
    </div>
</div>

{% endblock %}

{% block styles %}
<style>
body {
    background: #f8fafc;
}

/* Fade animation */
.fade-in {
    animation: fadeInUp 0.4s ease both;
}
@keyframes fadeInUp {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
}

/* Info grid layout */
.info-grid {
    display: grid;
    grid-template-columns: auto 1fr;
    gap: 8px 15px;
}

/* Card styling */
.card {
    border-radius: 20px;
    transition: transform 0.25s ease-in-out;
}
.card:hover {
    transform: scale(1.02);
}

/* Buttons */
.btn {
    border-radius: 10px;
}

/* Mobile-friendly spacing */
@media (max-width: 768px) {
    h3 {
        font-size: 1.5rem;
    }
    .card {
        border-radius: 16px;
    }
}
</style>
{% endblock %}
