<!-- templates/add_family.html -->
{% extends "base.html" %}
{% block title %}Add Family - Samaj Seva{% endblock %}

{% block content %}
<div class="container-fluid py-4 add-family-page">
  <div class="row justify-content-center">
    <div class="col-12 col-md-10 col-lg-8">
      <div class="card shadow-lg border-0 rounded-4">
        <div class="card-body p-4 p-md-5">
          <div class="d-flex justify-content-between align-items-center mb-3">
            <h2 class="fw-bold text-gradient">Add New Family / ркирк╡рлА рклрлЗркорк┐рк▓рлА ркЙркорлЗрк░рлЛ</h2>
            <a href="{{ url_for('families') }}" class="btn btn-sm btn-secondary">Back / рккрк╛ркЫрк╛ ркЬрк╛ркУ</a>
          </div>

          <form method="POST" enctype="multipart/form-data" id="familyForm">
            <!-- Head Information -->
            <h5 class="border-bottom pb-2 mb-3 text-primary">ЁЯСд Head Information / рк╡ркбрк╛ркирлА ркорк╛рк╣рк┐ркдрлА</h5>
            <div class="row g-3 mb-4">
              <div class="col-md-6">
                <label for="head_name" class="form-label fw-semibold">Head Name / рк╡ркбрк╛ркирлБркВ ркирк╛рко <span class="text-danger">*</span></label>
                <input type="text" class="form-control" id="head_name" name="head_name" required placeholder="Enter head name / рк╡ркбрк╛ркирлБркВ ркирк╛рко ркжрк╛ркЦрк▓ ркХрк░рлЛ">
              </div>

              <div class="col-md-6">
                <label for="head_photo" class="form-label fw-semibold">Head Photo / рк╡ркбрк╛ркирлЛ рклрлЛркЯрлЛ</label>
                <input type="file" class="form-control" id="head_photo" name="head_photo" accept="image/*" onchange="previewImage(this)">
                <div class="form-text">Supported formats: JPG, PNG, GIF (Max: 16MB)</div>
              </div>

              <div class="col-md-6">
                <label for="head_birthdate" class="form-label fw-semibold">Head Birth Date / ркЬркирлНрко ркдрк╛рк░рлАркЦ</label>
                <input type="date" class="form-control" id="head_birthdate" name="head_birthdate">
              </div>

              <div class="col-md-6">
                <label for="head_mosad" class="form-label fw-semibold">Occupation / рк╡рлНркпрк╡рк╕рк╛ркп</label>
                <input type="text" class="form-control" id="head_mosad" name="head_mosad" placeholder="Enter occupation / рк╡рлНркпрк╡рк╕рк╛ркп ркжрк╛ркЦрк▓ ркХрк░рлЛ">
              </div>
            </div>

            <!-- Family Details -->
            <h5 class="border-bottom pb-2 mb-3 text-primary">ЁЯПб Family Details / рклрлЗркорк┐рк▓рлА рк╡рк┐ркЧркдрлЛ</h5>
            <div class="row g-3 mb-4">
              <div class="col-md-6">
                <label for="village" class="form-label fw-semibold">Village / ркЧрк╛рко <span class="text-danger">*</span></label>
                <select class="form-select" id="village" name="village" required>
                  <option value="">Select Village / ркЧрк╛рко рккрк╕ркВркж ркХрк░рлЛ</option>
                  {% for village in villages %}
                  <option value="{{ village }}">{{ village }}</option>
                  {% endfor %}
                </select>
              </div>

              <div class="col-md-6">
                <label for="contact" class="form-label fw-semibold">Contact Number / рк╕ркВрккрк░рлНркХ ркиркВркмрк░</label>
                <input type="tel" class="form-control" id="contact" name="contact" placeholder="Enter mobile number / ркорлЛркмрк╛ркИрк▓ ркиркВркмрк░ ркжрк╛ркЦрк▓ ркХрк░рлЛ">
              </div>

              <div class="col-12">
                <label for="address" class="form-label fw-semibold">Address / рк╕рк░ркирк╛ркорлБркВ</label>
                <textarea class="form-control" id="address" name="address" rows="3" placeholder="Enter full address / рк╕ркВрккрлВрк░рлНркг рк╕рк░ркирк╛ркорлБркВ ркжрк╛ркЦрк▓ ркХрк░рлЛ"></textarea>
              </div>
            </div>

            <!-- Image Preview -->
            <div class="row mb-3" id="imagePreviewContainer" style="display: none;">
              <div class="col-12">
                <label class="form-label fw-semibold">Photo Preview / рклрлЛркЯрлЛ рккрлВрк░рлНрк╡ркжрк░рлНрк╢рки:</label>
                <div>
                  <img id="imagePreview" src="#" alt="Preview" class="img-thumbnail shadow-sm" style="max-height: 200px; border-radius: 10px;">
                </div>
              </div>
            </div>

            <div class="d-flex flex-column flex-md-row justify-content-center gap-3 mt-4">
              <button type="submit" class="btn btn-success px-4 py-2 fw-semibold">Add Family / рклрлЗркорк┐рк▓рлА ркЙркорлЗрк░рлЛ</button>
              <a href="{{ url_for('families') }}" class="btn btn-secondary px-4 py-2 fw-semibold">Cancel / рк░ркж ркХрк░рлЛ</a>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>

{% endblock %}

{% block scripts %}
<style>
.text-gradient {
  background: linear-gradient(45deg, #ff9966, #ff5e62);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
}

.add-family-page {
  background: linear-gradient(135deg, #f8fafc 0%, #e9effd 100%);
  min-height: 100vh;
}

.card {
  border-radius: 18px !important;
}

.form-control, .form-select {
  padding: 12px 15px;
  border-radius: 10px;
  border: 1.8px solid #dee2e6;
  font-size: 15px;
}

.form-control:focus, .form-select:focus {
  border-color: #ff5e62;
  box-shadow: 0 0 0 3px rgba(255, 94, 98, 0.15);
}

.btn-success {
  background: linear-gradient(45deg, #27ae60, #219653);
  border: none;
}

.btn-secondary {
  background: linear-gradient(45deg, #95a5a6, #7f8c8d);
  border: none;
}

/* Responsive Adjustments */
@media (max-width: 576px) {
  h2 {
    font-size: 1.6rem;
  }
  .card-body {
    padding: 1.5rem !important;
  }
  .btn {
    width: 100%;
  }
  .form-control, .form-select {
    font-size: 14px;
  }
}
</style>

<script>
  function previewImage(input) {
    const preview = document.getElementById('imagePreview');
    const container = document.getElementById('imagePreviewContainer');
    if (input.files && input.files[0]) {
      const reader = new FileReader();
      reader.onload = e => {
        preview.src = e.target.result;
        container.style.display = 'block';
      };
      reader.readAsDataURL(input.files[0]);
    } else {
      container.style.display = 'none';
    }
  }

  // Set max birthdate to today
  document.addEventListener("DOMContentLoaded", () => {
    document.getElementById('head_birthdate').max = new Date().toISOString().split('T')[0];
  });

  // Prevent double submit
  const form = document.getElementById("familyForm");
  const submitBtn = form.querySelector("button[type=submit]");
  form.addEventListener("submit", () => {
    submitBtn.disabled = true;
    submitBtn.textContent = "Adding Family...";
  });
</script>
{% endblock %}
